---
# TODO: remove this Service once the out-of-cluster replicaset members are gone.
apiVersion: v1
kind: Service
metadata:
  name: {{ include "router-mongo.fullname" . }}
  labels:
    {{- include "router-mongo.labels" . | nindent 4 }}
  annotations:
    service.beta.kubernetes.io/aws-load-balancer-nlb-target-type: ip
    service.beta.kubernetes.io/aws-load-balancer-scheme: internal
    service.beta.kubernetes.io/aws-load-balancer-type: nlb-ip
    kubernetes.io/description: >
      Temporary service to let Mongo nodes outside the k8s cluster connect to
      the one inside the cluster. Obsolete once the out-of-cluster nodes have
      been removed from the replicaset. Needs to be deleted before scaling out
      the statefulset beyond its initial replica.
spec:
  type: LoadBalancer
  loadBalancerSourceRanges:
    - 10.0.0.0/8
  selector:
    {{- include "router-mongo.selectorLabels" . | nindent 4 }}
  ports:
    - port: 27017
      name: mongodb
