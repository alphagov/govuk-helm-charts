apiVersion: argoproj.io/v1alpha1
kind: WorkflowTemplate
metadata:
  name: update-image-tag
spec:
  entrypoint: update-image-tag 
  arguments:
    parameters:
      - name: imageTag
      - name: environment
      - name: application
      - name: repoName
      - name: imageTag
  templates:
    - name: update-image-tag
      inputs:
        parameters:
          - name: imageTag
          - name: environment
          - name: application
          - name: repoName
          - name: imageTag
      script:
        image: bitnami/minideb:latest
        command: [/bin/bash]
        env:
          - name: GIT_NAME
            valueFrom:
              secretKeyRef:
                name: govuk-ci-github-creds
                key: username
          - name: GITHUB_TOKEN
            valueFrom:
              secretKeyRef:
                name: govuk-ci-github-creds
                key: token
          - name: IMAGE_TAG
            value: "{{"{{inputs.parameters.imageTag}}"}}"
          - name: ENVIRONMENT
            value: "{{"{{inputs.parameters.environment}}"}}"
          - name: APPLICATION
            value: "{{"{{inputs.parameters.application}}"}}"
          - name: REPO_NAME
            value: "{{"{{inputs.parameters.repoName}}"}}"
        source: |
          {{- .Files.Get "scripts/update-image-tag.sh" | nindent 14 }}
