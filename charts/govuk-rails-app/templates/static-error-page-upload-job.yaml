{{- /*
To debug this template, run `helm template . --name-template=static`.
*/}}
{{- if eq .Release.Name "static" }}
apiVersion: batch/v1
kind: Job
metadata:
  name: static-error-page-upload
  annotations:
    argocd.argoproj.io/hook: PostSync
    argocd.argoproj.io/hook-delete-policy: HookSucceeded
spec:
  backoffLimit: 2
  template:
    spec:
      containers:
        - name: static-error-page-upload
          # TODO: find a way to keep this up-to-date
          image: amazon/aws-cli:2.4.25
          env:
            - name: GOVUK_ENVIRONMENT
              value: {{ .Values.govukEnvironment }}
          command:
            - "/bin/sh"
            - "-c"
            - |-
              {{- .Files.Get "static-error-page-upload.sh" | nindent 14 }}
      restartPolicy: Never
{{- end }}
