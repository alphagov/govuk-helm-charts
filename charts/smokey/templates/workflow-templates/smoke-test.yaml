apiVersion: argoproj.io/v1alpha1
kind: WorkflowTemplate
metadata:
  name: smoke-test
spec:
  entrypoint: smoke-test-template-runner
  arguments:
    parameters:
      - name: application
        value: # TODO: overridden
  templates:
    - name: smoke-test-template-runner
      inputs:
        parameters:
          - name: application
      container:
        image: "{{ .Values.appImage.repository }}:{{ .Values.appImage.tag }}"
        command: ["bundle", "exec", "cucumber", "--profile", "test", "--strict-undefined", "-t", "@app-{{"{{inputs.parameters.application}}"}}", "-t", "@replatforming", "-t", "not @notreplatforming and not @nottest"]
        env:
        - name: ENVIRONMENT
          value: "{{ .Values.govukEnvironment }}"
        - name: GOVUK_APP_DOMAIN
          value: "{{ .Values.appGovukAppDomain | default (printf "%s.%s.%s" .Release.Namespace .Values.govukEnvironment .Values.clusterDomain) }}"
        - name: GOVUK_WEBSITE_ROOT
          value: "{{ .Values.appGovukWebsiteRoot | default (printf "https://www-origin-%s.eks.%s.%s" .Release.Namespace .Values.govukEnvironment .Values.govukDomainExternal) }}"
