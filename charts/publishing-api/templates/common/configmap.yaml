apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Release.Name }}-env
  labels:
    {{- include "publishing-api.labels" . | nindent 4 }}
data:
  CONTENT_API_PROTOTYPE: "{{ .Values.common.env.contentApiPrototype }}"
  CONTENT_STORE: "{{ .Values.common.env.contentStore | default (printf "http://content-store-%s.eks.%s.%s" .Release.Namespace .Values.common.govukEnvironment .Values.common.govukDomainInternal) }}"
  DRAFT_CONTENT_STORE: "{{ .Values.common.env.draftContentStore | default (printf "http://draft-content-store-%s.eks.%s.%s" .Release.Namespace .Values.common.govukEnvironment .Values.common.govukDomainInternal) }}"
  DEFAULT_TTL: "{{ .Values.common.env.defaultTtl }}"
  GOVUK_APP_DOMAIN: "{{ .Values.common.env.govukAppDomain | default (printf "%s.eks.%s.%s" .Release.Namespace .Values.common.govukEnvironment .Values.common.govukDomainInternal) }}"
  GOVUK_APP_DOMAIN_EXTERNAL: "{{ .Values.common.govukDomainExternal | default (printf "%s.eks.%s.%s" .Release.Namespace .Values.common.govukEnvironment .Values.common.govukDomainExternal) }}"
  GOVUK_APP_NAME: "{{ .Values.common.env.govukAppName | default .Release.Name }}"
  GOVUK_APP_TYPE: "{{ .Values.common.env.govukAppType }}"
  GOVUK_CONTENT_SCHEMAS_PATH: "{{ .Values.common.govukContentSchemasPath }}"
  GOVUK_WEBSITE_ROOT: "{{ .Values.common.env.govukWebsiteRoot | default (printf "https://www-origin.%s.eks.%s.%s" .Release.Namespace .Values.common.govukEnvironment .Values.common.govukDomainExternal) }}"
  PLEK_SERVICE_CONTENT_STORE_URI: "{{ .Values.common.env.plekServiceContentStoreUri | default (printf "http://content-store.%s.%s" .Release.Namespace .Values.common.govukDomainInternal) }}"
  PLEK_SERVICE_DRAFT_ORIGIN_URI: "{{ .Values.common.env.plekServiceContentStoreUri | default (printf "https://draft-origin-%s.eks.%s.%s" .Release.Namespace .Values.common.govukEnvironment .Values.common.govukDomainExternal) }}"
  PLEK_SERVICE_SIGNON_URI: "{{ .Values.common.env.plekServiceSignonUri | default (printf "https://signon-%s.eks.%s.%s" .Release.Namespace .Values.common.govukEnvironment .Values.common.env.govukDomainExternal) }}"
  PORT: "{{ .Values.web.port }}"
  RABBITMQ_HOSTS: "{{ .Values.common.env.rabbitmqHosts | default (printf "rabbitmq.%s.%s" .Values.common.govukEnvironment "govuk-internal.digital")  }}" #TODO: fix internal domain
  RABBITMQ_VHOST: "{{ .Values.common.env.rabbitmqVhost }}"
  RAILS_ENV: "{{ .Values.common.env.railsEnv }}"
  RAILS_LOG_TO_STDOUT: "true"
  REDIS_URL: "{{ .Values.common.env.redisUrl }}"    # TODO: decide on Redis for EKS
  UNICORN_WORKER_PROCESSES: "{{ .Values.common.env.unicornWorkerProcesses }}"
