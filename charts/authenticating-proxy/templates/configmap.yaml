apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Release.Name }}-env
  labels:
    {{- include "authenticating-proxy.labels" . | nindent 4 }}
data:
  DEFAULT_TTL: "{{ .Values.env.defaultTtl }}"
  GOVUK_APP_DOMAIN: "{{ .Values.env.govukAppDomain | default (printf "%s.eks.%s.%s" .Release.Namespace .Values.govukEnvironment .Values.govukDomainInternal) }}"
  GOVUK_APP_DOMAIN_EXTERNAL: "{{ .Values.govukDomainExternal | default (printf "%s.eks.%s.%s" .Release.Namespace .Values.govukEnvironment .Values.govukDomainExternal) }}"
  GOVUK_APP_NAME: "{{ .Values.env.govukAppName | default .Release.Name }}"
  GOVUK_APP_TYPE: "{{ .Values.env.govukAppType }}"
  GOVUK_ENVIRONMENT: "{{ .Values.govukEnvironment }}"
  GOVUK_ENVIRONMENT_NAME: "{{ .Values.govukEnvironment }}"
  GOVUK_UPSTREAM_URI: "{{ .Values.env.govukUpstreamUri | default (printf "http://draft-router.%s.%s" .Release.Namespace .Values.govukDomainInternal) }}"
  GOVUK_WEBSITE_ROOT: "{{ .Values.env.govukWebsiteRoot | default (printf "https://www-origin-%s.eks.%s.%s" .Release.Namespace .Values.govukEnvironment .Values.govukDomainExternal) }}"
  PORT: "{{ .Values.port }}"
  RAILS_ENV: "{{ .Values.env.railsEnv }}"
  PLEK_SERVICE_SIGNON_URI: "{{ .Values.env.plekServiceSignonUri | default (printf "https://signon-%s.eks.%s.%s" .Release.Namespace .Values.govukEnvironment .Values.env.govukDomainExternal) }}"
  MONGODB_URI: "{{ .Values.env.mongodbUri | default (printf "mongodb://router-backend-1.%[1]s.%[2]s.%[3]s,router-backend-2.%[1]s.%[2]s.%[3]s,router-backend-3.%[1]s.%[2]s.%[3]s/authenticating_proxy_production" .Values.govukStack .Values.govukEnvironment "govuk-internal.digital") }}"  #TODO: internal domain is now set to cluster.
