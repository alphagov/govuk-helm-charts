# Default/example values for Publisher.
#
# The defaults marked "# change when running multiple copies" need changing
# when installing multiple copies of the chart in the same cluster, to avoid
# name clashes in external resources like load balancers.

image:
  repository: 172025368201.dkr.ecr.eu-west-1.amazonaws.com/publisher
  tag: latest

externalSecrets:
  enabled: true
  refreshInterval: 60m

emailGroupBusiness: mainstream-publisher-notifications-test@digital.cabinet-office.gov.uk
emailGroupCitizen: mainstream-publisher-notifications-test@digital.cabinet-office.gov.uk
emailGroupDev: mainstream-publisher-notifications-test@digital.cabinet-office.gov.uk
emailGroupForcePublishAlerts: mainstream-publisher-notifications-test@digital.cabinet-office.gov.uk
factCheckSubjectPrefix: test
factCheckUsername: govuk-fact-check-test@digital.cabinet-office.gov.uk
factCheckAddressFormat: factcheck+test-{id}@alphagov.co.uk
factCheckReplyToAddress: govuk-fact-check-test@digital.cabinet-office.gov.uk
factCheckReplyToId: govuk-fact-check-test@digital.cabinet-office.gov.uk
govukNotifyTemplateId: 123e4567-e89b-12d3-a456-426614174000
redisUrl: redis://shared-redis-govuk.eks.test.govuk-internal.digital

replicas: 1
workerReplicas: 1
port: 3000
dbMigrationEnabled: true
extraEnv:
  - name: GDS_SSO_OAUTH_ID
    valueFrom:
      secretKeyRef:
        name: signon-app-publisher-eks
        key: oauth_id
  - name: GDS_SSO_OAUTH_SECRET
    valueFrom:
      secretKeyRef:
        name: signon-app-publisher-eks
        key: oauth_secret
  - name: ASSET_MANAGER_BEARER_TOKEN
    valueFrom:
      secretKeyRef:
        name: "signon-token-publisher-asset-manager"
        key: bearer_token
  - name: PUBLISHING_API_BEARER_TOKEN
    valueFrom:
      secretKeyRef:
        name: "signon-token-publisher-publishing-api"
        key: bearer_token
  - name: FACT_CHECK_PASSWORD
    valueFrom:
      secretKeyRef:
        name: publisher
        key: FACT_CHECK_PASSWORD
  - name: FACT_CHECK_REPLY_TO_ADDRESS
    valueFrom:
      secretKeyRef:
        name: publisher
        key: FACT_CHECK_REPLY_TO_ADDRESS
  - name: FACT_CHECK_REPLY_TO_ID
    valueFrom:
      secretKeyRef:
        name: publisher
        key: FACT_CHECK_REPLY_TO_ID
  - name: GA_UNIVERSAL_ID
    valueFrom:
      secretKeyRef:
        name: publisher
        key: GA_UNIVERSAL_ID
  - name: GOVUK_NOTIFY_API_KEY
    valueFrom:
      secretKeyRef:
        name: publisher
        key: GOVUK_NOTIFY_API_KEY
  - name: GOVUK_NOTIFY_TEMPLATE_ID
    valueFrom:
      secretKeyRef:
        name: publisher
        key: GOVUK_NOTIFY_TEMPLATE_ID
  - name: JWT_AUTH_SECRET
    valueFrom:
      secretKeyRef:
        name: publisher
        key: JWT_AUTH_SECRET
  - name: LINK_CHECKER_API_BEARER_TOKEN
    valueFrom:
      secretKeyRef:
        name: publisher
        key: LINK_CHECKER_API_BEARER_TOKEN
  - name: LINK_CHECKER_API_SECRET_TOKEN
    valueFrom:
      secretKeyRef:
        name: publisher
        key: LINK_CHECKER_API_SECRET_TOKEN
  - name: MONGODB_URI
    valueFrom:
      secretKeyRef:
        name: publisher
        key: MONGODB_URI
  - name: SECRET_KEY_BASE
    valueFrom:
      secretKeyRef:
        name: publisher
        key: SECRET_KEY_BASE
# - name: RETICULATE_SPLINES
#   value: true

nginx:
  image:
    repository: nginx
    pullPolicy: Always
    tag: stable
  port: 80

service:
  type: NodePort
  annotations: {}
  port: 80

ingress:
  enabled: true
  # TODO: template this stuff in ../argocd-apps chart and simplify this to a
  # generic example, then get rid of the header comment about avoiding name
  # clashes when running multiple copies.
  annotations:
    alb.ingress.kubernetes.io/scheme: internet-facing
    alb.ingress.kubernetes.io/target-type: ip
    alb.ingress.kubernetes.io/listen-ports: '[{"HTTP": 80}, {"HTTPS": 443}]'
    alb.ingress.kubernetes.io/ssl-redirect: "443"
    alb.ingress.kubernetes.io/healthcheck-path: /healthcheck/ready
    alb.ingress.kubernetes.io/load-balancer-name: publisher  # change when running multiple copies
  hosts:
  - host: publisher.eks.test.govuk.digital  # change when running multiple copies
    paths:
    - path: /
      pathType: Prefix

resources: {}
#   limits:
#     cpu: 500m
#     memory: 512Mi
#   requests:
#     cpu: 500m
#     memory: 512Mi

workerResources: {}
#   limits:
#     cpu: 500m
#     memory: 512Mi
#   requests:
#     cpu: 500m
#     memory: 512Mi
