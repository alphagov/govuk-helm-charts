# Licensify Components
nameOverride: "licensify"

licensify:
  # Admin Config
  admin:
    fullnameOverride: "licensify-admin"

    image:
      repository: 172025368201.dkr.ecr.eu-west-1.amazonaws.com/licensify/admin
      tag: release_210-bdbf4b90
      pullPolicy: IfNotPresent

    count: 1

    ingress:
      enabled: true
      annotations:
        alb.ingress.kubernetes.io/scheme: internet-facing
        alb.ingress.kubernetes.io/target-type: ip
        alb.ingress.kubernetes.io/listen-ports: '[{"HTTP": 80}, {"HTTPS": 443}]'
        alb.ingress.kubernetes.io/ssl-redirect: "443"
        alb.ingress.kubernetes.io/healthcheck-path: /
        alb.ingress.kubernetes.io/load-balancer-name: licensify-admin
        alb.ingress.kubernetes.io/load-balancer-attributes: >
          access_logs.s3.enabled=true,
          access_logs.s3.bucket=govuk-production-aws-logging,
          access_logs.s3.prefix=elb/licensify-admin
      class: "aws-alb"
      hosts:
        - host: licensify-admin.eks.production.govuk.digital
          paths:
            - path: /
              pathType: Prefix

      tls:
        # - hosts: 
        #   - licensify-admin.eks.production.govuk.digital

    service:
      type: NodePort
      nodePort: 30950
      port: 80
      targetPort: 9950

  # Backend Config
  backend:
    fullnameOverride: "licensify-backend"

    image:
      repository: 172025368201.dkr.ecr.eu-west-1.amazonaws.com/licensify/backend
      tag: release_210-bdbf4b90
      pullPolicy: IfNotPresent

    count: 1

    ingress:
      enabled: false
      annotations: {}
      class: "nginx"
      hosts:
        - host: backend
          paths:
            - path: /
              pathType: Prefix
      tls:
      #  - secretName: chart-example-tls
      #    hosts:
      #      - chart-example.local

    service:
      type: NodePort
      nodePort: 30920
      port: 9920
      targetPort: 9920

# Dummyservices Config (Dev Only)
  dummyservices:
    fullnameOverride: "licensify-dummyservices"

    image:
      repository: 172025368201.dkr.ecr.eu-west-1.amazonaws.com/licensify/dummyservices
      tag: release_210-bdbf4b90
      pullPolicy: IfNotPresent

    count: 1

    ingress:
      enabled: false
      annotations: {}
      class: "nginx"
      hosts:
        - host: dummyservices
          paths:
            - path: /
              pathType: Prefix

      tls:
      #  - secretName: chart-example-tls
      #    hosts:
      #      - chart-example.local

    service:
      type: NodePort
      nodePort: 30910
      port: 9910
      targetPort: 9910

  # Feed Config
  feed:
    fullnameOverride: "licensify-feed"

    image:
      repository: 172025368201.dkr.ecr.eu-west-1.amazonaws.com/licensify/feed
      tag: release_210-bdbf4b90
      pullPolicy: IfNotPresent

    count: 1

    ingress:
      enabled: true
      annotations:
        alb.ingress.kubernetes.io/scheme: internet-facing
        alb.ingress.kubernetes.io/target-type: ip
        alb.ingress.kubernetes.io/listen-ports: '[{"HTTP": 80}, {"HTTPS": 443}]'
        alb.ingress.kubernetes.io/ssl-redirect: "443"
        alb.ingress.kubernetes.io/healthcheck-path: /licence-management/feed/process-applications
        alb.ingress.kubernetes.io/load-balancer-name: licensify-feed
        alb.ingress.kubernetes.io/load-balancer-attributes: >
          access_logs.s3.enabled=true,
          access_logs.s3.bucket=govuk-production-aws-logging,
          access_logs.s3.prefix=elb/licensify-feed
      class: "aws-alb"
      hosts:
        - host: licensify-feed.eks.production.govuk.digital
          paths:
            - path: /
              pathType: Prefix
      tls: []
      #  - hosts:
      #      - licensify-feed.eks.integration.govuk.digital

    service:
      type: NodePort
      nodePort: 30940
      port: 80
      targetPort: 9940

  # Frontend Config
  frontend:
    fullnameOverride: "licensify-frontend"

    image:
      repository: 172025368201.dkr.ecr.eu-west-1.amazonaws.com/licensify/frontend
      tag: release_210-bdbf4b90
      pullPolicy: IfNotPresent

    count: 1

    ingress:
      enabled: true
      annotations:
        alb.ingress.kubernetes.io/scheme: internet-facing
        alb.ingress.kubernetes.io/target-type: ip
        alb.ingress.kubernetes.io/listen-ports: '[{"HTTP": 80}, {"HTTPS": 443}]'
        alb.ingress.kubernetes.io/ssl-redirect: "443"
        alb.ingress.kubernetes.io/healthcheck-path: /apply-for-a-licence
        alb.ingress.kubernetes.io/load-balancer-name: licensify-frontend
        alb.ingress.kubernetes.io/load-balancer-attributes: >
          access_logs.s3.enabled=true,
          access_logs.s3.bucket=govuk-production-aws-logging,
          access_logs.s3.prefix=elb/licensify-frontend
      class: "aws-alb"
      hosts:
        - host: licensify.eks.production.govuk.digital
          paths:
            - path: /
              pathType: Prefix

      tls: []
      #  - hosts:
      #     - licensify.eks.integration.govuk.digital

    service:
      type: NodePort
      nodePort: 30903
      port: 80
      targetPort: 9903

  # Shared Environment Variables
  env:
    - name: SBT_MODE
      value: docker
    - name: GDS_CONFIG_FILE
      value: /etc/licensing/gds-licensing-config.properties
    - name: APPLICATION_FORM_AWS_REGION
      value: eu-west-1
    - name: APPLICATION_FORM_BUCKET_NAME
      value: govuk-licensing-application-forms-production
    - name: APPLICATION_FORM_AWS_ACCESS_KEY_ID
      value: "set-in-config-instead"
    - name: APPLICATION_FORM_AWS_SECRET_KEY
      value: "set-in-config-instead"

  # imagePullSecrets:
  #   - name: ghcr-alphagov

  # Config for GDS Licensing Config .properties File
  # (See templates/configmap-gds-licensing-config-template.yaml)
  config:
    # MongoDB Config
    mongo:
      dbHosts: licensify-documentdb-0.cafmt8xopqlp.eu-west-1.docdb.amazonaws.com,licensify-documentdb-1.cafmt8xopqlp.eu-west-1.docdb.amazonaws.com,licensify-documentdb-2.cafmt8xopqlp.eu-west-1.docdb.amazonaws.com
      dbReferenceName: licensify-refdata
      dbAuditName: licensify-audit
      dbAuthEnabled: true
      dbAuthUsername: master
      dbAuthPassword: ExternalSecret
      dbSlaveOk: false

    # ELMS/Licensify Service Endpoints
    elmsAdminHost: https://licensify-admin.eks.production.govuk.digital/
    elmsFrontendHost: https://licensify.eks.production.govuk.digital/
    elmsPdfApiHost: https://gdsprodaws.aptosolutions.co.uk/GDSELMS-5/

    # Other Service Endpoints
    govukUrl: https://licensify.eks.production.govuk.digital/
    licenceFinderUrl: https://www-origin.publishing.service.gov.uk/licence-finder
    performancePlatformServiceUrl: https://www.performance.service.gov.uk/data/licensing/application

    # Callback URLs
    accessTokenUrl: https://signon.publishing.service.gov.uk/oauth/access_token
    authorizationUrl: https://signon.publishing.service.gov.uk/oauth/authorize
    oauthCallbackUrlOverride: https://licensify-admin.eks.production.govuk.digital/licence-management/admin/oauth
    signonUrl: https://signon.publishing.service.gov.uk
    # uploadUrlBase: https://uploadlicence.publishing.service.gov.uk/
    uploadUrlBase: https://licensify.eks.production.govuk.digital/
    userDetailsUrl: https://signon.publishing.service.gov.uk/user.json
    worldpayRedirectUrl: https://licensify.eks.production.govuk.digital/apply-for-a-licence/payment/worldpayComplete
    worldpayCancelledRedirectUrl: https://licensify.eks.production.govuk.digital/apply-for-a-licence/payment/worldpayCancelled

    # GA Config
    googleAnalytics:
      accountAdmin: UA-34530684-2
      domainAdmin: publishing.service.gov.uk
      accountFrontend: UA-26179049-1
      domainFrontend: .www.gov.uk

    # Notify Configuration
    noReplyMailAddress: noreply-licensing+production@digital.cabinet-office.gov.uk

    # Other Settings    
    appTimezoneId: Europe/London
    elmsMaxAppProcessAttemptCount: 6
    feedActor: true
    isMasterNode: true
    paymentsTestMode: true
    performanceDataSenderCronExpression: 0 0 1 * * ?
    scheduledVirusScanCronExpression: 0 0 16 * * ?
