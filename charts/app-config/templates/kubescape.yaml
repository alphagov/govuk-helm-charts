{{ if eq .Values.govukEnvironment "integration" }}
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: kubescape
spec:
  destination:
    name: kubescape
    namespace: kubescape
    server: https://kubernetes.default.svc
  source:
    {{- include "app-config.helm-release"
        ( merge (deepCopy .) (dict "repoURL" "https://github.com/kubescape/helm-charts" "path" "charts/kubescape-operator" "targetRevision" "HEAD") )
        | nindent 4 }}
    helm:
      valueFiles:
        - values.yaml
      parameters:
        - name: account
          value: "123456" # Dummy value
        - name: clusterName
          value: "govuk-integration-new"
        - name: server
          value: "https://kubernetes.default.svc"
  project: default
  syncPolicy:
    syncOptions:
      - PruneLast=true
      - CreateNamespace=true
      - RespectIgnoreDifferences=true
  ignoreDifferences:
    - group: core
      kind: ConfigMap
      name: ks-cloud-config
      namespace: kubescape
      jsonPointers:
        - /data
        - /metadata
{{ end }}
