# Defaults for all apps in this environment. These can be overridden for
# individual apps below.
govukEnvironment: staging
externalDomainSuffix: eks.staging.govuk.digital
publishingServiceDomainSuffix: staging.publishing.service.gov.uk
assetsDomain: assets.staging.publishing.service.gov.uk
# TODO: Remove once fully migrated to EKS
assetsTestDomain: assets-eks.staging.publishing.service.gov.uk
wwwTestDomain: www.eks.staging.govuk.digital

cspReportURI: https://csp-reporter.staging.publishing.service.gov.uk/report

appResources:
  limits:
    cpu: 1
    memory: 1500Mi
  requests:
    cpu: 0.1
    memory: 800Mi

default-alb-ingress-annotations: &default-alb-ingress-annotations
  alb.ingress.kubernetes.io/scheme: internet-facing
  alb.ingress.kubernetes.io/target-type: ip
  alb.ingress.kubernetes.io/listen-ports: '[{"HTTP": 80}, {"HTTPS": 443}]'
  alb.ingress.kubernetes.io/ssl-redirect: "443"
  alb.ingress.kubernetes.io/healthcheck-path: /readyz

# Individual apps to be deployed by ArgoCD, and any values specific to those
# apps.
govukApplications:
- name: asset-manager
  chartPath: charts/asset-manager
  helmValues:
    workerEnabled: true
    ingress:
      enabled: true
      annotations:
        <<: *default-alb-ingress-annotations
        alb.ingress.kubernetes.io/load-balancer-name: assets-origin
        alb.ingress.kubernetes.io/group.name: assets-origin
        alb.ingress.kubernetes.io/group.order: '20'
        alb.ingress.kubernetes.io/load-balancer-attributes: access_logs.s3.enabled=true,access_logs.s3.bucket=govuk-staging-aws-logging,access_logs.s3.prefix=elb/assets-origin-eks
        alb.ingress.kubernetes.io/conditions.{{ .Release.Name }}: >
          [{"field":"host-header","hostHeaderConfig":{"values":["{{ .Values.assetsDomain }}", "{{ .Values.assetsTestDomain }}"]}}]
      hosts:
      - name: assets-origin.eks.staging.govuk.digital
        path: /government/uploads/
      - name: assets-origin.eks.staging.govuk.digital
        path: /media/
    assetManagerNFS: &assets-nfs assets.blue.staging.govuk-internal.digital
    nginxConfigMap:
      create: false
      name: asset-manager-nginx-conf
    extraEnv:
      - name: ASSET_MANAGER_CLAMSCAN_PATH
        value: /usr/bin/clamdscan
      - name: GDS_SSO_OAUTH_ID
        valueFrom:
          secretKeyRef:
            name: signon-app-asset-manager
            key: oauth_id
      - name: GDS_SSO_OAUTH_SECRET
        valueFrom:
          secretKeyRef:
            name: signon-app-asset-manager
            key: oauth_secret
      - name: GOVUK_ASSET_ROOT  # testing in isolation
        value: https://assets.staging.publishing.service.gov.uk
      - name: JWT_AUTH_SECRET
        valueFrom:
          secretKeyRef:
            name: authenticating-proxy-jwt-auth-secret
            key: JWT_AUTH_SECRET
      - name: MONGODB_URI
        valueFrom:
          secretKeyRef:
            name: asset-manager-docdb
            key: MONGODB_URI
      - name: REDIS_URL
        value: redis://shared-redis-govuk.eks.staging.govuk-internal.digital
      - name: SECRET_KEY_BASE
        valueFrom:
          secretKeyRef:
            name: rails-secret-key-base
            key: SECRET_KEY_BASE
      - name: AWS_REGION
        value: eu-west-1
      - name: AWS_S3_BUCKET_NAME
        value: govuk-assets-staging

- name: argo-services
  chartPath: charts/argo-services
  postSyncWorkflowEnabled: "false"
  helmValues:
    nextEnvironment: production

- name: collections
  helmValues:
    extraEnv:
      - name: SECRET_KEY_BASE
        valueFrom:
          secretKeyRef:
            name: rails-secret-key-base
            key: SECRET_KEY_BASE
      - name: MEMCACHE_SERVERS
        value: frontend-memcached-govuk.eks.staging.govuk-internal.digital
      - name: EMAIL_ALERT_API_BEARER_TOKEN
        valueFrom:
          secretKeyRef:
            name: signon-token-collections-email-alert-api
            key: bearer_token

- name: email-alert-frontend
  helmValues:
    extraEnv:
      - name: SUBSCRIPTION_MANAGEMENT_ENABLED
        value: "yes"  # non-prod only
      - name: REDIS_URL
        value: redis://shared-redis-govuk.eks.staging.govuk-internal.digital
      - name: SECRET_KEY_BASE
        valueFrom:
          secretKeyRef:
            name: email-alert-rails-secret-key-base
            key: SECRET_KEY_BASE
      - name: ACCOUNT_API_BEARER_TOKEN
        valueFrom:
          secretKeyRef:
            name: signon-token-email-alert-frontend-account-api
            key: bearer_token
      - name: EMAIL_ALERT_API_BEARER_TOKEN
        valueFrom:
          secretKeyRef:
            name: signon-token-email-alert-frontend-email-alert-api
            key: bearer_token
      - name: PUBLISHING_API_BEARER_TOKEN
        valueFrom:
          secretKeyRef:
            name: signon-token-email-alert-frontend-publishing-api
            key: bearer_token
      - name: EMAIL_ALERT_AUTH_TOKEN
        valueFrom:
          secretKeyRef:
            name: email-alert-auth
            key: token

- name: external-secrets
  chartPath: charts/external-secrets
  postSyncWorkflowEnabled: "false"

- name: feedback
  helmValues:
    extraEnv:
      - name: GOVUK_NOTIFY_ACCESSIBLE_FORMAT_REQUEST_REPLY_TO_ID
        value: d33f7857-7514-4458-81b9-0995f48e2ac5
      - name: GOVUK_NOTIFY_ACCESSIBLE_FORMAT_REQUEST_TEMPLATE_ID
        value: b67971ed-a249-4afa-b05e-9adad9da551a
      - name: GOVUK_NOTIFY_SURVEY_SIGNUP_REPLY_TO_ID
        value: d1f54751-80a8-420a-9077-d34c7d6cc734
      - name: GOVUK_NOTIFY_SURVEY_SIGNUP_TEMPLATE_ID
        value: 8a8d98c0-42c8-4f56-b61f-77c89417a171
      - name: SECRET_KEY_BASE
        valueFrom:
          secretKeyRef:
            name: rails-secret-key-base
            key: SECRET_KEY_BASE
      - name: SUPPORT_BEARER_TOKEN
        valueFrom:
          secretKeyRef:
            name: signon-token-feedback-support
            key: bearer_token
      - name: SUPPORT_API_BEARER_TOKEN
        valueFrom:
          secretKeyRef:
            name: signon-token-feedback-support-api
            key: bearer_token
      - name: PUBLISHING_API_BEARER_TOKEN
        valueFrom:
          secretKeyRef:
            name: signon-token-feedback-publishing-api
            key: bearer_token
      - name: ASSISTED_DIGITAL_GOOGLE_SPREADSHEET_KEY
        valueFrom:
          secretKeyRef:
            name: feedback-assisted-digital-google-sheet
            key: sheet_id
      - name: GOOGLE_CLIENT_EMAIL
        valueFrom:
          secretKeyRef:
            name: feedback-assisted-digital-google-sheet
            key: client_email
      - name: GOOGLE_PRIVATE_KEY
        valueFrom:
          secretKeyRef:
            name: feedback-assisted-digital-google-sheet
            key: private_key
      - name: GOVUK_NOTIFY_API_KEY
        valueFrom:
          secretKeyRef:
            name: feedback-notify
            key: GOVUK_NOTIFY_API_KEY

- name: finder-frontend
  helmValues:
    cronTasks:
      - name: registries-refresh
        task: "registries:cache_refresh"
        schedule: "15 * * * *"
    appResources:
      limits:
        cpu: 4
        memory: 1Gi
      requests:
        cpu: 2
        memory: 512Mi
    replicaCount: 3
    extraEnv:
      - name: SECRET_KEY_BASE
        valueFrom:
          secretKeyRef:
            name: rails-secret-key-base
            key: SECRET_KEY_BASE
      - name: MEMCACHE_SERVERS
        value: frontend-memcached-govuk.eks.staging.govuk-internal.digital
      - name: EMAIL_ALERT_API_BEARER_TOKEN
        valueFrom:
          secretKeyRef:
            name: signon-token-finder-frontend-email-alert-api
            key: bearer_token
      - name: WEB_CONCURRENCY
        value: '4'

- name: frontend
  helmValues:
    appResources:
      limits:
        cpu: 4
        memory: 1Gi
      requests:
        cpu: 2
        memory: 512Mi
    extraEnv:
      - name: GOVUK_NOTIFY_TEMPLATE_ID
        value: 2844a647-6bf1-4b01-a25c-569d2cc00849
      - name: MEMCACHE_SERVERS
        value: frontend-memcached-govuk.eks.staging.govuk-internal.digital
      - name: WEB_CONCURRENCY
        value: '4'
      - name: ACCOUNT_API_BEARER_TOKEN
        valueFrom:
          secretKeyRef:
            name: signon-token-frontend-account-api
            key: bearer_token
      - name: ELECTIONS_API_KEY
        valueFrom:
          secretKeyRef:
            name: frontend-elections-api
            key: key
      - name: ELECTIONS_API_URL
        valueFrom:
          secretKeyRef:
            name: frontend-elections-api
            key: url
      - name: EMAIL_ALERT_API_BEARER_TOKEN
        valueFrom:
          secretKeyRef:
            name: signon-token-frontend-email-alert-api
            key: bearer_token
      - name: PUBLISHING_API_BEARER_TOKEN
        valueFrom:
          secretKeyRef:
            name: signon-token-frontend-publishing-api
            key: bearer_token
      - name: SECRET_KEY_BASE
        valueFrom:
          secretKeyRef:
            name: frontend-rails-secret-key-base
            key: SECRET_KEY_BASE

- name: government-frontend
  helmValues:
    appResources:
      limits:
        cpu: 2
        memory: 1Gi
      requests:
        cpu: 1
        memory: 512Mi
    extraEnv:
      - name: SECRET_KEY_BASE
        valueFrom:
          secretKeyRef:
            name: rails-secret-key-base
            key: SECRET_KEY_BASE
      - name: MEMCACHE_SERVERS
        value: frontend-memcached-govuk.eks.staging.govuk-internal.digital

- name: licencefinder
  repoName: licence-finder
  helmValues:
    uploadAssets:
      # https://github.com/alphagov/licence-finder/blob/e60ad6b/config/application.rb#L35
      path: /app/public/assets/licencefinder
      s3Directory: "licencefinder"
    extraEnv:
      # TODO: Use a custom DNS name for ElasticSearch/OpenSearch. See
      # https://aws.amazon.com/about-aws/whats-new/2020/11/amazon-elasticsearch-service-now-supports-defining-a-custom-name-for-your-domain-endpoint/
      - name: ELASTICSEARCH_URI
        value: "https://vpc-blue-elasticsearch6-domain-uibh77cu2kiudtl76uhseobfzq.eu-west-1.es.amazonaws.com"
      - name: MONGODB_URI  # Hostnames need to match those shown in MongoDB rs.status().
        value: "mongodb://\
          mongo-1.staging.govuk-internal.digital,\
          mongo-2.staging.govuk-internal.digital,\
          mongo-3.staging.govuk-internal.digital/licence_finder_production"
      - name: SECRET_KEY_BASE
        valueFrom:
          secretKeyRef:
            name: rails-secret-key-base
            key: SECRET_KEY_BASE
      - name: PUBLISHING_API_BEARER_TOKEN
        valueFrom:
          secretKeyRef:
            name: signon-token-licence-finder-publishing-api
            key: bearer_token

- name: release
  helmValues:
    dbMigrationEnabled: true
    ingress:
      enabled: true
      annotations:
        <<: *default-alb-ingress-annotations
        alb.ingress.kubernetes.io/load-balancer-name: release
      hosts:
        - name: release.eks.staging.govuk.digital
    extraEnv:
      - name: GDS_SSO_OAUTH_ID
        valueFrom:
          secretKeyRef:
            name: signon-app-release
            key: oauth_id
      - name: GDS_SSO_OAUTH_SECRET
        valueFrom:
          secretKeyRef:
            name: signon-app-release
            key: oauth_secret
      - name: DATABASE_URL
        valueFrom:
          secretKeyRef:
            name: release-mysql
            key: DATABASE_URL
      - name: SECRET_KEY_BASE
        valueFrom:
          secretKeyRef:
            name: rails-secret-key-base
            key: SECRET_KEY_BASE
      - name: GITHUB_USERNAME
        valueFrom:
          secretKeyRef:
            name: release-github
            key: username
      - name: GITHUB_ACCESS_TOKEN
        valueFrom:
          secretKeyRef:
            name: release-github
            key: token

- name: router
  helmValues:
    uploadAssets:
      enabled: false
    appResources:
      limits:
        cpu: 3
        memory: 2Gi
      requests:
        cpu: 2
        memory: 1Gi
    dnsConfig:  # TODO: remove dnsConfig once MongoDB migrated to DocDB.
      searches:
        - blue.staging.govuk-internal.digital
    ingress:
      enabled: true
      annotations:
        <<: *default-alb-ingress-annotations
        alb.ingress.kubernetes.io/security-groups: eks_ingress_www_origin
        alb.ingress.kubernetes.io/load-balancer-name: www-origin
        alb.ingress.kubernetes.io/load-balancer-attributes: access_logs.s3.enabled=true,access_logs.s3.bucket=govuk-staging-aws-logging,access_logs.s3.prefix=elb/www-origin-eks
        alb.ingress.kubernetes.io/conditions.{{ .Release.Name }}: >
          [{"field":"host-header","hostHeaderConfig":{"values":["www.{{ .Values.publishingServiceDomainSuffix }}", "{{ .Values.wwwTestDomain }}"]}}]
      hosts:
        - name: www-origin.eks.staging.govuk.digital
    nginxConfigMap:
      create: false
      name: live-router-nginx-conf
    nginxExtraVolumeMounts:
      - name: live-router-nginx-conf
        mountPath: /usr/share/nginx/html/robots.txt
        subPath: robots.txt
    appProbes: &router-app-probes
      startupProbe: &router-probe
        httpGet:
          path: /healthcheck
          port: 9394
        failureThreshold: 10
        periodSeconds: 1
        timeoutSeconds: 1
      livenessProbe:
        <<: *router-probe
        failureThreshold: 3
        periodSeconds: 5
      readinessProbe:
        <<: *router-probe
        httpGet:
          path: /healthcheck
          port: 9394
        failureThreshold: 2
        periodSeconds: 5
    extraEnv:
      - name: SENTRY_ENVIRONMENT
        value: "staging-eks"
      - name: ROUTER_PUBADDR
        value: ":3000"
      - name: ROUTER_APIADDR
        value: ":9394"
      - name: ROUTER_MONGO_URL
        value: &router_mongo_hosts "\
          router-backend-1,\
          router-backend-2,\
          router-backend-3"
      - name: BACKEND_URL_collections
        value: "http://collections"
      - name: BACKEND_URL_content-store
        value: "https://content-store.staging.govuk-internal.digital"
      - name: BACKEND_URL_email-alert-frontend
        value: "http://email-alert-frontend"
      - name: BACKEND_URL_frontend
        value: "http://frontend"
      - name: BACKEND_URL_government-frontend
        value: "http://government-frontend"
      - name: BACKEND_URL_service-manual-frontend
        value: "http://service-manual-frontend"
      - name: BACKEND_URL_smartanswers
        value: "http://smartanswers"
      - name: BACKEND_URL_static
        value: "http://static"
      - name: BACKEND_URL_whitehall-frontend
        value: "http://whitehall-frontend"
        # TODO: switch back to in-cluster account-api once it's fully working (similarly for draft).
      - name: BACKEND_URL_account-api
        value: "https://account-api.staging.govuk-internal.digital"
      - name: BACKEND_URL_feedback
        value: "http://feedback"
      - name: BACKEND_URL_finder-frontend
        value: "http://finder-frontend"
      - name: BACKEND_URL_info-frontend
        value: "http://info-frontend"
      - name: BACKEND_URL_licencefinder
        value: "http://licencefinder"
      - name: BACKEND_URL_licensify
        value: "https://licensify.staging.govuk-internal.digital"
        # TODO: switch back to in-cluster search-api once it's fully working (similarly for draft).
      - name: BACKEND_URL_search-api
        value: "https://search-api.staging.govuk-internal.digital"

- name: service-manual-frontend
  helmValues:
    extraEnv:
      - name: SECRET_KEY_BASE
        valueFrom:
          secretKeyRef:
            name: rails-secret-key-base
            key: SECRET_KEY_BASE

- name: signon
  helmValues:
    dbMigrationEnabled: true
    workerEnabled: true
    ingress:
      enabled: true
      annotations:
        <<: *default-alb-ingress-annotations
        alb.ingress.kubernetes.io/load-balancer-name: signon
        alb.ingress.kubernetes.io/security-groups: eks_ingress_www_origin
      hosts:
        - name: signon.eks.staging.govuk.digital
    workerReplicaCount: 1
    cronTasks:
      - name: "kubernetes-sync-app-secrets"
        task: "kubernetes:sync_app_secrets[signon-secrets-sync-conf]"
        schedule: "5 1 * * *"
        serviceAccount: signon
      - name: "kubernetes-sync-token-secrets"
        task: "kubernetes:sync_token_secrets[signon-secrets-sync-conf]"
        schedule: "5 1 * * *"
        serviceAccount: signon
      - name: "delete-event-logs"
        task: "event_log:delete_logs_older_than_two_years"
        schedule: "15 1 * * *"
    extraEnv:
      - name: GOVUK_NOTIFY_TEMPLATE_ID
        value: 112842bb-d8a4-4511-90de-57dc5c8f27ec
      - name: INSTANCE_NAME
        value: staging
      - name: ACTIVE_RECORD_ENCRYPTION_PRIMARY_KEY
        valueFrom:
          secretKeyRef:
            name: active-record-encryption
            key: ACTIVE_RECORD_ENCRYPTION_PRIMARY_KEY
      - name: ACTIVE_RECORD_ENCRYPTION_KEY_DERIVATION_SALT
        valueFrom:
          secretKeyRef:
            name: active-record-encryption
            key: ACTIVE_RECORD_ENCRYPTION_KEY_DERIVATION_SALT
      - name: DATABASE_URL
        valueFrom:
          secretKeyRef:
            name: signon-mysql
            key: DATABASE_URL
      - name: DEVISE_PEPPER
        valueFrom:
          secretKeyRef:
            name: signon-devise-pepper
            key: DEVISE_PEPPER
      - name: DEVISE_SECRET_KEY
        valueFrom:
          secretKeyRef:
            name: signon-devise-secret
            key: DEVISE_SECRET_KEY
      - name: SECRET_KEY_BASE
        valueFrom:
          secretKeyRef:
            name: rails-secret-key-base
            key: SECRET_KEY_BASE
      - name: REDIS_URL
        value: redis://shared-redis-govuk.eks.staging.govuk-internal.digital
      - name: SIGNON_APPS_URI_SUB_PATTERN
        value: staging.publishing.service.gov.uk
      - name: SIGNON_APPS_URI_SUB_REPLACEMENT
        value: eks.staging.govuk.digital
      - name: SIGNON_ADMIN_PASSWORD
        valueFrom:
          secretKeyRef:
            name: signon-auth-token
            key: token

- name: info-frontend
  helmValues:
    extraEnv:
      - name: SECRET_KEY_BASE
        valueFrom:
          secretKeyRef:
            name: rails-secret-key-base
            key: SECRET_KEY_BASE

- name: smartanswers
  repoName: smart-answers
  helmValues:
    uploadAssets:
      # https://github.com/alphagov/smart-answers/blob/9b65057/config/application.rb#L50
      path: /app/public/assets/smartanswers
      s3Directory: "smartanswers"
    extraEnv:
      - name: LINK_CHECKER_API_BEARER_TOKEN
        valueFrom:
          secretKeyRef:
            name: signon-token-smart-answers-link-checker-api
            key: bearer_token
      - name: PUBLISHING_API_BEARER_TOKEN
        valueFrom:
          secretKeyRef:
            name: signon-token-smart-answers-publishing-api
            key: bearer_token
      - name: SECRET_KEY_BASE
        valueFrom:
          secretKeyRef:
            name: rails-secret-key-base
            key: SECRET_KEY_BASE
      - name: ZENDESK_CLIENT_USERNAME
        valueFrom:
          secretKeyRef:
            name: smartanswers-zendesk-client
            key: username
      - name: ZENDESK_CLIENT_PASSWORD
        valueFrom:
          secretKeyRef:
            name: smartanswers-zendesk-client
            key: password

- name: smokey
  chartPath: charts/smokey

- name: static
  helmValues:
    uploadStaticErrorPagesEnabled: true
    ingress:
      hosts:
        - name: assets-origin.eks.staging.govuk.digital
          path: /
      enabled: true
      annotations:
        <<: *default-alb-ingress-annotations
        alb.ingress.kubernetes.io/load-balancer-name: assets-origin
        alb.ingress.kubernetes.io/group.name: assets-origin
        alb.ingress.kubernetes.io/group.order: '30'
        alb.ingress.kubernetes.io/load-balancer-attributes: access_logs.s3.enabled=true,access_logs.s3.bucket=govuk-staging-aws-logging,access_logs.s3.prefix=elb/assets-origin-eks
        alb.ingress.kubernetes.io/conditions.{{ .Release.Name }}: >
          [{"field":"host-header","hostHeaderConfig":{"values":["{{ .Values.assetsDomain }}", "{{ .Values.assetsTestDomain }}"]}}]
    extraEnv:
      # These GA/GTM values are not secrets (not even the the gtm_auth one).
      # https://github.com/alphagov/govuk-puppet/pull/8041
      - name: GA_UNIVERSAL_ID
        value: &ga-universal-id UA-26179049-20
      - name: GOOGLE_TAG_MANAGER_ID
        value: &static-gtm-id GTM-MG7HG5W
      - name: GOOGLE_TAG_MANAGER_AUTH  # Non-prod only.
        value: &static-gtm-auth oJWs562CxSIjZKn_GlB5Bw
      - name: GOOGLE_TAG_MANAGER_PREVIEW  # Non-prod only.
        value: &static-gtm-preview env-5
      - name: PUBLISHING_API_BEARER_TOKEN
        valueFrom:
          secretKeyRef:
            name: signon-token-static-publishing-api
            key: bearer_token
      - name: REDIS_URL
        value: redis://shared-redis-govuk.eks.staging.govuk-internal.digital
      - name: SECRET_KEY_BASE
        valueFrom:
          secretKeyRef:
            name: rails-secret-key-base
            key: SECRET_KEY_BASE
      - name: USE_TMPDIR_PAGE_CACHE
        value: "true"
    nginxConfigMap:
      extraConf: |
        # 1stline use this URL in their zendesk template
        location = /static/gov.uk_logotype_crown.png {
          absolute_redirect off;
          return 301 /media/5c810ef4ed915d43e50ce260/gov.uk_logotype_crown.png;
        }

- name: whitehall-frontend
  repoName: whitehall
  helmValues:
    ingress:
      hosts:
        - name: assets-origin.eks.staging.govuk.digital
          path: /government/placeholder/
        - name: assets-origin.eks.staging.govuk.digital
          path: /assets/whitehall/
        - name: assets-origin.eks.staging.govuk.digital
          path: /government/uploads/system/uploads/attachment_data/file/*/*/preview
          pathType: ImplementationSpecific
      enabled: true
      annotations:
        <<: *default-alb-ingress-annotations
        alb.ingress.kubernetes.io/load-balancer-name: assets-origin
        alb.ingress.kubernetes.io/group.name: assets-origin
        alb.ingress.kubernetes.io/group.order: '10'
        alb.ingress.kubernetes.io/load-balancer-attributes: access_logs.s3.enabled=true,access_logs.s3.bucket=govuk-staging-aws-logging,access_logs.s3.prefix=elb/assets-origin-eks
        alb.ingress.kubernetes.io/conditions.{{ .Release.Name }}: >
          [{"field":"host-header","hostHeaderConfig":{"values":["{{ .Values.assetsDomain }}", "{{ .Values.assetsTestDomain }}"]}}]
    appResources:
      limits:
        memory: 4Gi
        cpu: "2"
      requests:
        memory: 2Gi
        cpu: "1"
    appProbes:
      startupProbe:
        failureThreshold: 10
        httpGet:
          path: /healthcheck/live
          port: http
          scheme: HTTP
        periodSeconds: 3
        successThreshold: 1
        timeoutSeconds: 15
      livenessProbe:
        failureThreshold: 3
        httpGet:
          path: /healthcheck/live
          port: http
          scheme: HTTP
        periodSeconds: 10
        successThreshold: 1
        timeoutSeconds: 30
      readinessProbe:
        failureThreshold: 3
        httpGet:
          path: /healthcheck/live
          port: http
          scheme: HTTP
        periodSeconds: 10
        successThreshold: 1
        timeoutSeconds: 30
    nginxProxyReadTimeout: 30
    extraEnv: &whitehall-envs
      - name: GDS_SSO_OAUTH_ID
        valueFrom:
          secretKeyRef:
            name: signon-app-whitehall
            key: oauth_id
      - name: GDS_SSO_OAUTH_SECRET
        valueFrom:
          secretKeyRef:
            name: signon-app-whitehall
            key: oauth_secret
      - name: ASSET_MANAGER_BEARER_TOKEN
        valueFrom:
          secretKeyRef:
            name: signon-token-whitehall-asset-manager
            key: bearer_token
      - name: GOVUK_NOTIFY_API_KEY
        valueFrom:
          secretKeyRef:
            name: whitehall-notify
            key: GOVUK_NOTIFY_API_KEY
      - name: JWT_AUTH_SECRET
        valueFrom:
          secretKeyRef:
            name: authenticating-proxy-jwt-auth-secret
            key: JWT_AUTH_SECRET
      - name: LINK_CHECKER_API_BEARER_TOKEN
        valueFrom:
          secretKeyRef:
            name: signon-token-whitehall-link-checker-api
            key: bearer_token
      - name: LINK_CHECKER_API_SECRET_TOKEN
        valueFrom:
          secretKeyRef:
            name: whitehall-link-checker-api-callback-token
            key: LINK_CHECKER_API_SECRET_TOKEN
      - name: PUBLISHING_API_BEARER_TOKEN
        valueFrom:
          secretKeyRef:
            name: signon-token-whitehall-publishing-api
            key: bearer_token
      - name: AWS_S3_BUCKET_NAME
        value: govuk-staging-whitehall-csvs
      - name: GOVUK_NOTIFY_TEMPLATE_ID
        value: 112842bb-d8a4-4511-90de-57dc5c8f27ec
      - name: EMAIL_ADDRESS_OVERRIDE
        value: whitehall-emails-staging@digital.cabinet-office.gov.uk
      - name: REDIS_URL
        value: redis://shared-redis-govuk.eks.staging.govuk-internal.digital
      - name: MEMCACHE_SERVERS
        value: frontend-memcached-govuk.eks.staging.govuk-internal.digital
      - name: DATABASE_URL
        valueFrom:
          secretKeyRef:
            name: whitehall-mysql
            key: DATABASE_URL
      - name: SECRET_KEY_BASE
        valueFrom:
          secretKeyRef:
            name: rails-secret-key-base
            key: SECRET_KEY_BASE
