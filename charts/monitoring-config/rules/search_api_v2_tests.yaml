rule_files:
  - search_api_v2.yaml

evaluation_interval: 1m

tests:
  - interval: 1m
    input_series:
      # Should alert (too low)
      - series: >-
          search_api_v2_quality_monitoring_score{dataset_name="dataset1", dataset_type="invariants"}
        values: '0.9 0.99 1 0.95'
      # Should not alert (perfect scores)
      - series: >-
          search_api_v2_quality_monitoring_score{dataset_name="dataset2", dataset_type="invariants"}
        values: '1 1 1 1'
      # Should not alert (wrong type)
      - series: >-
          search_api_v2_quality_monitoring_score{dataset_name="dataset3",
          dataset_type="something_else"}
        values: '0.1 0.2 0.3 0.4'
    alert_rule_test:
      - eval_time: 4m
        alertname: LowInvariantScore
        exp_alerts:
          - exp_labels:
              alertname: LowInvariantScore
              dataset_name: "dataset1"
              dataset_type: "invariants"
              severity: "warning"
              destination: "slack-search-team"
            exp_annotations:
              summary: "Low invariant recall score for 'dataset1'"
              description: >-
                Invariant dataset 'dataset1' has dropped below 100% recall (i.e. the expected
                results are not being returned for one or more queries in this dataset)
